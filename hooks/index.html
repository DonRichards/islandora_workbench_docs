<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Hooks - Islandora Workbench</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../css/extra.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Islandora Workbench</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../installation/" class="nav-link">Requirements and installation</a>
                            </li>
                            <li class="navitem">
                                <a href="../configuration/" class="nav-link">Configuration</a>
                            </li>
                            <li class="navitem">
                                <a href="../check/" class="nav-link">Checking configuration and input data</a>
                            </li>
                            <li class="navitem">
                                <a href="../preparing_data/" class="nav-link">Preparing your data</a>
                            </li>
                            <li class="navitem">
                                <a href="../fields/" class="nav-link">Field data (Drupal and CSV)</a>
                            </li>
                            <li class="navitem">
                                <a href="../ignoring_csv_rows_and_columns/" class="nav-link">Ignoring CSV rows and columns</a>
                            </li>
                            <li class="navitem">
                                <a href="../field_templates/" class="nav-link">CSV field templates</a>
                            </li>
                            <li class="navitem">
                                <a href="../paged_and_compound/" class="nav-link">Creating paged, compound, and collection content</a>
                            </li>
                            <li class="navitem">
                                <a href="../nodes_only/" class="nav-link">Creating nodes without media</a>
                            </li>
                            <li class="navitem">
                                <a href="../creating_nodes_from_files/" class="nav-link">Creating nodes from files</a>
                            </li>
                            <li class="navitem">
                                <a href="../creating_taxonomy_terms/" class="nav-link">Creating taxonomy terms</a>
                            </li>
                            <li class="navitem">
                                <a href="../aliases/" class="nav-link">Assigning URL aliases</a>
                            </li>
                            <li class="navitem">
                                <a href="../alt_text/" class="nav-link">Adding alt text to images</a>
                            </li>
                            <li class="navitem">
                                <a href="../rolling_back/" class="nav-link">Rolling back nodes and media</a>
                            </li>
                            <li class="navitem">
                                <a href="../media_types/" class="nav-link">Setting media types</a>
                            </li>
                            <li class="navitem">
                                <a href="../updating_nodes/" class="nav-link">Updating nodes</a>
                            </li>
                            <li class="navitem">
                                <a href="../deleting_nodes/" class="nav-link">Deleting nodes</a>
                            </li>
                            <li class="navitem">
                                <a href="../adding_media/" class="nav-link">Adding media to nodes</a>
                            </li>
                            <li class="navitem">
                                <a href="../deleting_media/" class="nav-link">Deleting media</a>
                            </li>
                            <li class="navitem">
                                <a href="../adding_multiple_media/" class="nav-link">Adding multiple media</a>
                            </li>
                            <li class="navitem">
                                <a href="../generating_csv_files/" class="nav-link">Generating CSV files</a>
                            </li>
                            <li class="navitem">
                                <a href="../sample_data/" class="nav-link">Creating nodes from the sample data</a>
                            </li>
                            <li class="navitem">
                                <a href="../exporting_islandora_7_content/" class="nav-link">Exporting Islandora 7 content</a>
                            </li>
                            <li class="navitem">
                                <a href="../generating_sample_content/" class="nav-link">Generating sample Islandora content</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Hooks</a>
                            </li>
                            <li class="navitem">
                                <a href="../fixity/" class="nav-link">Fixity checking</a>
                            </li>
                            <li class="navitem">
                                <a href="../logging/" class="nav-link">Logging</a>
                            </li>
                            <li class="navitem">
                                <a href="../cancelling/" class="nav-link">Cancelling Workbench</a>
                            </li>
                            <li class="navitem">
                                <a href="../workflows/" class="nav-link">Workflows</a>
                            </li>
                            <li class="navitem">
                                <a href="../reducing_load/" class="nav-link">Reducing Workbench's impact on Drupal</a>
                            </li>
                            <li class="navitem">
                                <a href="../limitations/" class="nav-link">Known limitations</a>
                            </li>
                            <li class="navitem">
                                <a href="../roadmap/" class="nav-link">Roadmap (Fall 2021)</a>
                            </li>
                            <li class="navitem">
                                <a href="../troubleshooting/" class="nav-link">Troubleshooting</a>
                            </li>
                            <li class="navitem">
                                <a href="../changelog/" class="nav-link">Change log</a>
                            </li>
                            <li class="navitem">
                                <a href="../development_guide/" class="nav-link">Development guide</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../generating_sample_content/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../fixity/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/mjordan/islandora_workbench_docs/edit/main/docs/hooks.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#hooks" class="nav-link">Hooks</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="hooks">Hooks</h2>
<p>Islandora Workbench offers three "hooks" that can be used to run scripts at specific points in the Workbench execution lifecycle. The three hooks are:</p>
<ol>
<li>Bootstrap</li>
<li>CSV preprocessor</li>
<li>Post-action</li>
</ol>
<p>Hook scripts can be in any language, and need to be executable by the user running Workbench.</p>
<p>Execution (whether successful or not) of hook scripts is logged, including the scripts' exit code.</p>
<h3 id="bootstrap-and-shutdown-scripts">Bootstrap and shutdown scripts</h3>
<p>Bootstrap scripts execute prior to Workbench connecting to Drupal. For an example of using this feature to run a script that generates sample Islandora content, see the "<a href="/islandora_workbench_docs/generating_sample_content/">Generating sample Islandora content</a>" section.</p>
<p>To register a bootstrap script in your configuration file, add it to the <code>bootstrap</code> option, like this:</p>
<pre><code class="language-yaml">bootstrap: [&quot;/home/mark/Documents/hacking/workbench/generate_image_files.py&quot;]
</code></pre>
<p>Each bootstrap script gets passed a single argument, the path to the Workbench config file that was specified in Workbench's <code>--config</code> argument. For example, if you are running Workbench with a config file called <code>create.yml</code>, <code>create.yml</code> will be passed as the argumement to your bootstrap script. </p>
<p>Shutdown scripts work the same way as bootstrap scripts but they execute after Workbench has finished connecting to Drupal. A common situation where a shutdown script is useful is to check the Workbench log for failures, and if any are detected, to email someone. To register a shutdown script, add it to the <code>shutdown</code> option:</p>
<pre><code class="language-yaml">shutdown: [&quot;/home/mark/Documents/hacking/workbench/shutdown_example.py&quot;]
</code></pre>
<p><code>--check</code> will check for the existence of bootstrap and shutdown scripts, and that they are executable, but does not execute them. The scripts are only executed when Workbench is run without <code>--check</code>.</p>
<p>Very basic example bootstrap and shutdown scripts can be found in the <code>scripts</code> folder.</p>
<h3 id="csv-preprocessor-scripts">CSV preprocessor scripts</h3>
<p>CSV preprocessor scripts are applied to CSV values prior to the values being ingested into Drupal. They apply to the entire value from the CSV field and not split field values, e.g., if a field is multivalued, the preprocesor must split it and then reassemble it back into a string before printint it to STDOUT. Note that preprocessor scripts work only on string data and not on binary data like images, etc. and only on custom fields (so not title). If you are interested in seeing preprocessor scripts act on binary data such as images, see this <a href="https://github.com/mjordan/islandora_workbench/issues/45">issue</a>.</p>
<p>For example, you might want to convert all the values in a CSV field to sentence case. You can do this by writing a small Python script that uses the <code>capitalize()</code> method and registering it as a preprocessor. </p>
<p>To register a preprocessor script in your configuration file, add it to the <code>preprocessors</code> option, like this:</p>
<pre><code class="language-yaml">preprocessors: [&quot;/home/mark/Documents/hacking/workbench/scripts/samplepreprocessor.py&quot;]
</code></pre>
<p>Each preprocessor script gets passed two arguments:</p>
<ol>
<li>the character used as the CSV subdelimiter (defined in the <code>subdelimiter</code> config option, which defaults to <code>|</code>)</li>
<li>the CSV field value</li>
</ol>
<h3 id="post-action-scripts">Post-action scripts</h3>
<p>Post-action scripts execute after a node is created or updated, or after a media is created.  </p>
<p>To register post-action scripts in your configuration file, add them to either the <code>node_post_create</code>, <code>node_post_update</code>, or <code>media_post_create</code> configuration setting:</p>
<pre><code class="language-yaml">node_post_create: [&quot;/home/mark/Documents/hacking/workbench/post_node_create.py&quot;]
</code></pre>
<pre><code class="language-yaml">node_post_update: [&quot;/home/mark/Documents/hacking/workbench/post_node_update.py&quot;]
</code></pre>
<pre><code class="language-yaml">media_post_create: [&quot;/home/mark/Documents/hacking/workbench/post_media_update.py&quot;]
</code></pre>
<p>The arguments passed to each post-action hook are:</p>
<ol>
<li>the path to the Workbench config file that was specified in the <code>--config</code> argument</li>
<li>the HTTP response code returned from the action (create, update), e.g. <code>201</code> or <code>403</code>. Note that this response code is a string, not an integer.</li>
<li>the entire HTTP response body; this will be raw JSON.</li>
</ol>
<p>These arguments are passed to post-action scripts automatically. You don't specific them when you register your scripts in your config file. The <code>scripts/entity_post_task_example.py</code> illustrates these arguments.</p>
<p>Your scripts can find the entity ID and other information within the (raw JSON) HTTP response body. Using the way Python decodes JSON as an example, if the entity is a node, its nid is in <code>entity_json['nid'][0]['value']</code>; if the entity is a media, the mid is in <code>entity_json['mid'][0]['value']</code>. The exact location of the nid and mid may differ if your script is written in a language that decodes JSON differently than Python (used in this example) does.</p>
<h4 id="running-multiple-scripts-in-one-hook">Running multiple scripts in one hook</h4>
<p>For all types of hooks, you can register multiple scripts, like this:</p>
<pre><code class="language-yaml">bootstrap: [&quot;/home/mark/Documents/hacking/workbench/bootstrap_example_1.py&quot;, &quot;/home/mark/Documents/hacking/workbench/bootstrap_example_2.py&quot;]
shutdown: [&quot;/home/mark/Documents/hacking/workbench/shutdown_example_1.py&quot;, &quot;/home/mark/Documents/hacking/workbench/shutdown_example_2.py&quot;]
node_post_create: [&quot;/home/mark/scripts/email_someone.py&quot;, &quot;/tmp/hit_remote_api.py&quot;]
</code></pre>
<p>They are executed in the order in which they are listed.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
