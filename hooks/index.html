<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Hooks - Islandora Workbench</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Hooks";
        var mkdocs_page_input_path = "hooks.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Islandora Workbench
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation/">Requirements and installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../configuration/">Configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../check/">Checking configuration and input data</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../preparing_data/">Preparing your data</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../fields/">Field data (Drupal and CSV)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ignoring_csv_rows_and_columns/">Ignoring CSV rows and columns</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../field_templates/">CSV field templates</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../paged_and_compound/">Creating paged, compound, and collection content</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../nodes_only/">Creating nodes without media</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../creating_nodes_from_files/">Creating nodes from files</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../creating_taxonomy_terms/">Creating taxonomy terms</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../aliases/">Assigning URL aliases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../alt_text/">Adding alt text to images</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../rolling_back/">Rolling back nodes and media</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../media_types/">Setting media types</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../updating_nodes/">Updating nodes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../deleting_nodes/">Deleting nodes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../adding_media/">Adding media to nodes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../deleting_media/">Deleting media</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../adding_multiple_media/">Adding multiple media</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../generating_csv_files/">Generating CSV files</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../sample_data/">Creating nodes from the sample data</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../exporting_islandora_7_content/">Exporting Islandora 7 content</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../generating_sample_content/">Generating sample Islandora content</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Hooks</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#bootstrap-and-shutdown-scripts">Bootstrap and shutdown scripts</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#csv-preprocessor-scripts">CSV preprocessor scripts</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#post-action-scripts">Post-action scripts</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#running-multiple-scripts-in-one-hook">Running multiple scripts in one hook</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../fixity/">Fixity checking</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../logging/">Logging</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cancelling/">Cancelling Workbench</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../workflows/">Workflows</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../reducing_load/">Reducing Workbench's impact on Drupal</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../limitations/">Known limitations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../roadmap/">Roadmap (Fall 2021)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../changelog/">Change log</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../development_guide/">Development guide</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Islandora Workbench</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Hooks</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/mjordan/islandora_workbench_docs/edit/main/docs/hooks.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="hooks">Hooks</h2>
<p>Islandora Workbench offers three "hooks" that can be used to run scripts at specific points in the Workbench execution lifecycle. The three hooks are:</p>
<ol>
<li>Bootstrap</li>
<li>CSV preprocessor</li>
<li>Post-action</li>
</ol>
<p>Hook scripts can be in any language, and need to be executable by the user running Workbench.</p>
<p>Execution (whether successful or not) of hook scripts is logged, including the scripts' exit code.</p>
<h3 id="bootstrap-and-shutdown-scripts">Bootstrap and shutdown scripts</h3>
<p>Bootstrap scripts execute prior to Workbench connecting to Drupal. For an example of using this feature to run a script that generates sample Islandora content, see the "<a href="/islandora_workbench_docs/generating_sample_content/">Generating sample Islandora content</a>" section.</p>
<p>To register a bootstrap script in your configuration file, add it to the <code>bootstrap</code> option, like this:</p>
<pre><code class="language-yaml">bootstrap: [&quot;/home/mark/Documents/hacking/workbench/generate_image_files.py&quot;]
</code></pre>
<p>Each bootstrap script gets passed a single argument, the path to the Workbench config file that was specified in Workbench's <code>--config</code> argument. For example, if you are running Workbench with a config file called <code>create.yml</code>, <code>create.yml</code> will be passed as the argumement to your bootstrap script. </p>
<p>Shutdown scripts work the same way as bootstrap scripts but they execute after Workbench has finished connecting to Drupal. A common situation where a shutdown script is useful is to check the Workbench log for failures, and if any are detected, to email someone. To register a shutdown script, add it to the <code>shutdown</code> option:</p>
<pre><code class="language-yaml">shutdown: [&quot;/home/mark/Documents/hacking/workbench/shutdown_example.py&quot;]
</code></pre>
<p><code>--check</code> will check for the existence of bootstrap and shutdown scripts, and that they are executable, but does not execute them. The scripts are only executed when Workbench is run without <code>--check</code>.</p>
<p>Very basic example bootstrap and shutdown scripts can be found in the <code>scripts</code> folder.</p>
<h3 id="csv-preprocessor-scripts">CSV preprocessor scripts</h3>
<p>CSV preprocessor scripts are applied to CSV values prior to the values being ingested into Drupal. They apply to the entire value from the CSV field and not split field values, e.g., if a field is multivalued, the preprocesor must split it and then reassemble it back into a string before printint it to STDOUT. Note that preprocessor scripts work only on string data and not on binary data like images, etc. and only on custom fields (so not title). If you are interested in seeing preprocessor scripts act on binary data such as images, see this <a href="https://github.com/mjordan/islandora_workbench/issues/45">issue</a>.</p>
<p>For example, you might want to convert all the values in a CSV field to sentence case. You can do this by writing a small Python script that uses the <code>capitalize()</code> method and registering it as a preprocessor. </p>
<p>To register a preprocessor script in your configuration file, add it to the <code>preprocessors</code> option, like this:</p>
<pre><code class="language-yaml">preprocessors: [&quot;/home/mark/Documents/hacking/workbench/scripts/samplepreprocessor.py&quot;]
</code></pre>
<p>Each preprocessor script gets passed two arguments:</p>
<ol>
<li>the character used as the CSV subdelimiter (defined in the <code>subdelimiter</code> config option, which defaults to <code>|</code>)</li>
<li>the CSV field value</li>
</ol>
<h3 id="post-action-scripts">Post-action scripts</h3>
<p>Post-action scripts execute after a node is created or updated, or after a media is created.  </p>
<p>To register post-action scripts in your configuration file, add them to either the <code>node_post_create</code>, <code>node_post_update</code>, or <code>media_post_create</code> configuration setting:</p>
<pre><code class="language-yaml">node_post_create: [&quot;/home/mark/Documents/hacking/workbench/post_node_create.py&quot;]
</code></pre>
<pre><code class="language-yaml">node_post_update: [&quot;/home/mark/Documents/hacking/workbench/post_node_update.py&quot;]
</code></pre>
<pre><code class="language-yaml">media_post_create: [&quot;/home/mark/Documents/hacking/workbench/post_media_update.py&quot;]
</code></pre>
<p>The arguments passed to each post-action hook are:</p>
<ol>
<li>the path to the Workbench config file that was specified in the <code>--config</code> argument</li>
<li>the HTTP response code returned from the action (create, update), e.g. <code>201</code> or <code>403</code>. Note that this response code is a string, not an integer.</li>
<li>the entire HTTP response body; this will be raw JSON.</li>
</ol>
<p>These arguments are passed to post-action scripts automatically. You don't specific them when you register your scripts in your config file. The <code>scripts/entity_post_task_example.py</code> illustrates these arguments.</p>
<p>Your scripts can find the entity ID and other information within the (raw JSON) HTTP response body. Using the way Python decodes JSON as an example, if the entity is a node, its nid is in <code>entity_json['nid'][0]['value']</code>; if the entity is a media, the mid is in <code>entity_json['mid'][0]['value']</code>. The exact location of the nid and mid may differ if your script is written in a language that decodes JSON differently than Python (used in this example) does.</p>
<h4 id="running-multiple-scripts-in-one-hook">Running multiple scripts in one hook</h4>
<p>For all types of hooks, you can register multiple scripts, like this:</p>
<pre><code class="language-yaml">bootstrap: [&quot;/home/mark/Documents/hacking/workbench/bootstrap_example_1.py&quot;, &quot;/home/mark/Documents/hacking/workbench/bootstrap_example_2.py&quot;]
shutdown: [&quot;/home/mark/Documents/hacking/workbench/shutdown_example_1.py&quot;, &quot;/home/mark/Documents/hacking/workbench/shutdown_example_2.py&quot;]
node_post_create: [&quot;/home/mark/scripts/email_someone.py&quot;, &quot;/tmp/hit_remote_api.py&quot;]
</code></pre>
<p>They are executed in the order in which they are listed.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../generating_sample_content/" class="btn btn-neutral float-left" title="Generating sample Islandora content"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../fixity/" class="btn btn-neutral float-right" title="Fixity checking">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/mjordan/islandora_workbench_docs" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../generating_sample_content/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../fixity/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
