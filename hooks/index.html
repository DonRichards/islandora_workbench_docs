<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Hooks - Islandora Workbench</title>
  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Hooks";
    var mkdocs_page_input_path = "hooks.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Islandora Workbench</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../installation/">Requirements and installation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../configuration/">Configuration</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../check/">Checking configuration and input data</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../preparing_data/">Preparing your data</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../fields/">Field data (Drupal and CSV)</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../field_templates/">CSV field templates</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../paged_and_compound/">Creating paged, compound, and collection content</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../nodes_only/">Creating nodes without media</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../creating_nodes_from_files/">Creating nodes from files</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../creating_taxonomy_terms/">Creating taxonomy terms</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../aliases/">Assigning URL aliases</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../alt_text/">Adding alt text to images</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../rolling_back/">Rolling back nodes and media</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../media_types/">Setting media types</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../updating_nodes/">Updating nodes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../deleting_nodes/">Deleting nodes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../adding_media/">Adding media to nodes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../deleting_media/">Deleting media</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../adding_multiple_media/">Adding multiple media</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../generating_csv_files/">Generating CSV files</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../sample_data/">Creating nodes from the sample data</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../exporting_islandora_7_content/">Exporting Islandora 7 content</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../generating_sample_content/">Generating sample Islandora content</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Hooks</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#hooks">Hooks</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#bootstrap-and-shutdown-scripts">Bootstrap and shutdown scripts</a></li>
        
            <li><a class="toctree-l3" href="#csv-preprocessor-scripts">CSV preprocessor scripts</a></li>
        
            <li><a class="toctree-l3" href="#post-action-scripts">Post-action scripts</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../fixity/">Fixity checking</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../logging/">Logging</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../cancelling/">Cancelling Workbench</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../workflows/">Workflows</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../reducing_load/">Reducing Workbench's impact on Drupal</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../limitations/">Known limitations</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../roadmap/">Roadmap (Fall 2021)</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../troubleshooting/">Troubleshooting</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../changelog/">Change log</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../development_guide/">Development guide</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Islandora Workbench</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Hooks</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/mjordan/islandora_workbench_docs/edit/main/docs/hooks.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="hooks">Hooks</h2>
<p>Islandora Workbench offers three "hooks" that can be used to run scripts at specific points in the Workbench execution lifecycle. The three hooks are:</p>
<ol>
<li>Bootstrap</li>
<li>CSV preprocessor</li>
<li>Post-action</li>
</ol>
<p>Hook scripts can be in any language, and need to be executable by the user running Workbench.</p>
<p>Execution (whether successful or not) of hook scripts is logged, including the scripts' exit code.</p>
<h3 id="bootstrap-and-shutdown-scripts">Bootstrap and shutdown scripts</h3>
<p>Bootstrap scripts execute prior to Workbench connecting to Drupal. For an example of using this feature to run a script that generates sample Islandora content, see the "<a href="/islandora_workbench_docs/generating_sample_content/">Generating sample Islandora content</a>" section.</p>
<p>To register a bootstrap script in your configuration file, add it to the <code>bootstrap</code> option, like this:</p>
<pre><code class="yaml">bootstrap: [&quot;/home/mark/Documents/hacking/workbench/generate_image_files.py&quot;]
</code></pre>

<p>Each bootstrap script gets passed a single argument, the path to the Workbench config file that was specified in Workbench's <code>--config</code> argument. For example, if you are running Workbench with a config file called <code>create.yml</code>, <code>create.yml</code> will be passed as the argumement to your bootstrap script. </p>
<p>Shutdown scripts work the same way as bootstrap scripts but they execute after Workbench has finished connecting to Drupal. A common situation where a shutdown script is useful is to check the Workbench log for failures, and if any are detected, to email someone. To register a shutdown script, add it to the <code>shutdown</code> option:</p>
<pre><code class="yaml">shutdown: [&quot;/home/mark/Documents/hacking/workbench/shutdown_example.py&quot;]
</code></pre>

<p><code>--check</code> will check for the existence of bootstrap and shutdown scripts, and that they are executable, but does not execute them. The scripts are only executed when Workbench is run without <code>--check</code>.</p>
<p>Very basic example bootstrap and shutdown scripts can be found in the <code>scripts</code> folder.</p>
<h3 id="csv-preprocessor-scripts">CSV preprocessor scripts</h3>
<p>CSV preprocessor scripts are applied to CSV values prior to the values being ingested into Drupal. They apply to the entire value from the CSV field and not split field values, e.g., if a field is multivalued, the preprocesor must split it and then reassemble it back into a string before printint it to STDOUT. Note that preprocessor scripts work only on string data and not on binary data like images, etc. and only on custom fields (so not title). If you are interested in seeing preprocessor scripts act on binary data such as images, see this <a href="https://github.com/mjordan/islandora_workbench/issues/45">issue</a>.</p>
<p>For example, you might want to convert all the values in a CSV field to sentence case. You can do this by writing a small Python script that uses the <code>capitalize()</code> method and registering it as a preprocessor. </p>
<p>To register a preprocessor script in your configuration file, add it to the <code>preprocessors</code> option, like this:</p>
<pre><code class="yaml">preprocessors: [&quot;/home/mark/Documents/hacking/workbench/scripts/samplepreprocessor.py&quot;]
</code></pre>

<p>Each preprocessor script gets passed two arguments:</p>
<ol>
<li>the character used as the CSV subdelimiter (defined in the <code>subdelimiter</code> config option, which defaults to <code>|</code>)</li>
<li>the CSV field value</li>
</ol>
<h3 id="post-action-scripts">Post-action scripts</h3>
<p>Post-action scripts execute after a node is created or updated, or after a media is created.  </p>
<p>To register post-action scripts in your configuration file, add them to either the <code>node_post_create</code>, <code>node_post_update</code>, or <code>media_post_create</code> configuration setting:</p>
<pre><code class="yaml">node_post_create: [&quot;/home/mark/Documents/hacking/workbench/post_node_create.py&quot;]
</code></pre>

<pre><code class="yaml">node_post_update: [&quot;/home/mark/Documents/hacking/workbench/post_node_update.py&quot;]
</code></pre>

<pre><code class="yaml">media_post_create: [&quot;/home/mark/Documents/hacking/workbench/post_media_update.py&quot;]
</code></pre>

<p>The arguments passed to each post-action hook are:</p>
<ol>
<li>the path to the Workbench config file that was specified in the <code>--config</code> argument</li>
<li>the HTTP response code returned from the action (create, update), e.g. <code>201</code> or <code>403</code>. Note that this response code is a string, not an integer.</li>
<li>the entire HTTP response body; this will be raw JSON.</li>
</ol>
<p>These arguments are passed to post-action scripts automatically. You don't specific them when you register your scripts in your config file. The <code>scripts/entity_post_task_example.py</code> illustrates these arguments.</p>
<p>Your scripts can find the entity ID and other information within the (raw JSON) HTTP response body. Using the way Python decodes JSON as an example, if the entity is a node, its nid is in <code>entity_json['nid'][0]['value']</code>; if the entity is a media, the mid is in <code>entity_json['mid'][0]['value']</code>. The exact location of the nid and mid may differ if your script is written in a language that decodes JSON differently than Python (used in this example) does.</p>
<h4 id="running-multiple-scripts-in-one-hook">Running multiple scripts in one hook</h4>
<p>For all types of hooks, you can register multiple scripts, like this:</p>
<pre><code class="yaml">bootstrap: [&quot;/home/mark/Documents/hacking/workbench/bootstrap_example_1.py&quot;, &quot;/home/mark/Documents/hacking/workbench/bootstrap_example_2.py&quot;]
shutdown: [&quot;/home/mark/Documents/hacking/workbench/shutdown_example_1.py&quot;, &quot;/home/mark/Documents/hacking/workbench/shutdown_example_2.py&quot;]
node_post_create: [&quot;/home/mark/scripts/email_someone.py&quot;, &quot;/tmp/hit_remote_api.py&quot;]
</code></pre>

<p>They are executed in the order in which they are listed.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../fixity/" class="btn btn-neutral float-right" title="Fixity checking">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../generating_sample_content/" class="btn btn-neutral" title="Generating sample Islandora content"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/mjordan/islandora_workbench_docs/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../generating_sample_content/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../fixity/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
