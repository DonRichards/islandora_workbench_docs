<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Creating paged, compound, and collection content - Islandora Workbench</title>
  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Creating paged, compound, and collection content";
    var mkdocs_page_input_path = "paged_and_compound.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Islandora Workbench</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../installation/">Requirements and installation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../configuration/">Configuration</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../check/">Checking configuration and input data</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../preparing_data/">Preparing your data</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../fields/">Field data (Drupal and CSV)</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../field_templates/">CSV field templates</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Creating paged, compound, and collection content</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#using-subdirectories">Using subdirectories</a></li>
    

    <li class="toctree-l2"><a href="#with-pagechild-level-metadata">With page/child-level metadata</a></li>
    

    <li class="toctree-l2"><a href="#using-a-secondary-task">Using a secondary task</a></li>
    

    <li class="toctree-l2"><a href="#creating-collections-and-members-together">Creating collections and members together</a></li>
    

    <li class="toctree-l2"><a href="#summary">Summary</a></li>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../nodes_only/">Creating nodes without media</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../creating_nodes_from_files/">Creating nodes from files</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../creating_taxonomy_terms/">Creating taxonomy terms</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../aliases/">Assigning URL aliases</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../alt_text/">Adding alt text to images</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../rolling_back/">Rolling back nodes and media</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../media_types/">Setting media types</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../updating_nodes/">Updating nodes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../deleting_nodes/">Deleting nodes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../adding_media/">Adding media to nodes</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../deleting_media/">Deleting media</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../adding_multiple_media/">Adding multiple media</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../generating_csv_files/">Generating CSV files</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../sample_data/">Creating nodes from the sample data</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../exporting_islandora_7_content/">Exporting Islandora 7 content</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../generating_sample_content/">Generating sample Islandora content</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../hooks/">Hooks</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../fixity/">Fixity checking</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../logging/">Logging</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../cancelling/">Cancelling Workbench</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../workflows/">Workflows</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../limitations/">Known limitations</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../roadmap/">Roadmap (Fall 2021)</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../troubleshooting/">Troubleshooting</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../development_guide/">Development guide</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Islandora Workbench</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Creating paged, compound, and collection content</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/mjordan/islandora_workbench_docs/edit/main/docs/paged_and_compound.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Islandora Workbench provides three ways to create paged and compound content:</p>
<ul>
<li>using a specific subdirectory structure to define the relationship between the parent item and its children</li>
<li>using page-level metadata in the CSV to establish that relationship</li>
<li>using a secondary task.</li>
</ul>
<h3 id="using-subdirectories">Using subdirectories</h3>
<p>Enable this method by including <code>paged_content_from_directories: true</code> in your configuration file. Use this method when you are creating books, newspaper issues, or other paged content where your pages don't have their own metadata. This method groups page-level files into subdirectories that correspond to each parent, and does not require (or allow) page-level metadata in the CSV file. Each parent (book, newspaper issue, etc.) has a row on the CSV file, e.g.:</p>
<pre><code class="text">id,title,field_model,field_display_hints
book1,How to Use Islandora Workbench like a Pro,28,2
book2,Using Islandora Workbench for Fun and Profit,28,2
</code></pre>

<p>Each parent's pages are located in a subdirectory of the input directory that is named to match the value of the <code>id</code> field of the parent item they are pages of:</p>
<pre><code class="text">samplebook/
├── book1
│   ├── page-001.jpg
│   ├── page-002.jpg
│   └── page-003.jpg
├── book2
│   ├── isbn-1843341778-001.jpg
│   ├── using-islandora-workbench-page-002.jpg
│   └── page-003.jpg
└── metadata.csv
</code></pre>

<p>The page filenames have significance. The sequence of the page is determined by the last segment of each filename before the extension, and is separated from the rest of the filename by a dash (<code>-</code>), although you can use another character by setting the <code>paged_content_sequence_seprator</code> option in your configuration file. For example, using the filenames for "book1" above, the sequence of "page-001.jpg" is "001". Dashes (or whatever your separator character is) can exist elsewhere in filenames, since Workbench will always use the string after the <em>last</em> dash as the sequence number; for example, the sequence of "isbn-1843341778-001.jpg" for "book2" is also "001". Workbench takes this sequence number, strips of any leader zeros, and uses it to populate the <code>field_weight</code> in the page nodes, so "001" becomes a weight value of 1, "002" becomes a weight value of 2, and so on.</p>
<p>Titles for pages are generated automatically using the pattern <code>parent_title</code> + <code>, page</code> + <code>sequence_number</code>, where "parent title" is inherited from the page's parent node and "sequence number" is the page's sequence. For example, if a page's parent has the title "How to Write a Book" and its sequence number is 450, its automatically generated title will be "How to Write a Book, page 450".</p>
<p>Finally, even though only minimal metadata is assigned to pages using this method (i.e., the automatically generated title and Islandora model), you can add additional metadata to pages using a separate <code>update</code> task.</p>
<p>Important things to note when using this method:</p>
<ul>
<li>To use this method of creating paged content, you must include <code>paged_content_page_model_tid</code> in your configuration file and set it to your Islandora's term ID for the "Page" term in the Islandora Models vocabulary (or to <code>http://id.loc.gov/ontologies/bibframe/part</code>).</li>
<li>The Islandora model of the parent is not set automatically. You need to include a <code>field_model</code> value for each item in your CSV file.</li>
<li>You should also include a <code>field_display_hints</code> column in your CSV. This value is applied to the parent nodes and also the page nodes, unless the <code>paged_content_page_display_hints</code> setting is present in you configuration file. However, if you normally don't set the "Display hints" field in your objects but use a Context to determine how objects display, you should not include a <code>field_display_hints</code> column in your CSV file.</li>
<li>Unlike every other Islandora Workbench configuration, the metadata CSV should not contain a <code>file</code> column.</li>
<li><code>id</code> can be defined as another field name using the <code>id_field</code> configuration option. If you do define a different ID field using the <code>id_field</code> option, creating the parent/paged item relationships will still work.</li>
<li>The Drupal content type for page nodes is inherited from the parent, unless you specify a different content type in the <code>paged_content_page_content_type</code> setting in your configuration file.</li>
</ul>
<h3 id="with-pagechild-level-metadata">With page/child-level metadata</h3>
<p>Using this method, the metadata CSV file contains a row for every item, both parents and children. You should use this method when you are creating books, newspaper issues, or other paged or compound content where each page has its own metadata, or when you are creating compound objects of any Islandora model. The file for each page/child is named explicitly in the page/child's <code>file</code> column rather than being in a subdirectory. To link the pages to the parent, Workbench establishes parent/child relationships between items with <code>parent_id</code> values (the pages/children) with that are the same as the <code>id</code> value of another item (the parent). For this to work, your CSV file must contain a <code>parent_id</code> field plus the standard Islandora fields <code>field_weight</code>, <code>field_member_of</code>, and <code>field_model</code> (the role of these last three fields will be explained below). The <code>id</code> field is required in all CSV files used to create content, so in this case, your CSV needs both an <code>id</code> field and a <code>parent_id</code> field.</p>
<p>The following example illustrates how this works. Here is the raw CSV data:</p>
<pre><code class="text">id,parent_id,field_weight,file,title,field_description,field_model,field_member_of
001,,,,Postcard 1,The first postcard,28,197
003,001,1,image456.jpg,Front of postcard 1,The first postcard's front,29,
004,001,2,image389.jpg,Back of postcard 1,The first postcard's back,29,
002,,,,Postcard 2,The second postcard,28,197
006,002,1,image2828.jpg,Front of postcard 2,The second postcard's front,29,
007,002,2,image777.jpg,Back of postcard 2,The second postcard's back,29,
</code></pre>

<p>The empty cells make this CSV difficult to read. Here is the same data in a spreadsheet:</p>
<p><img alt="Paged content CSV" src="../images/paged_csv.png" /></p>
<p>The data contains rows for two postcards (rows with <code>id</code> values "001" and "002") plus a back and front for each (the remaining four rows). The <code>parent_id</code> value for items with <code>id</code> values "003" and "004" is the same as the <code>id</code> value for item "001", which will tell Workbench to make both of those items children of item "001"; the <code>parent_id</code> value for items with <code>id</code> values "006" and "007" is the same as the <code>id</code> value for item "002", which will tell Workbench to make both of those items children of the item "002". We can't populate  <code>field_member_of</code> for the child pages in our CSV because we won't have node IDs for the parents until they are created as part of the same batch as the children.</p>
<p>In this example, the rows for our postcard objects have empty <code>parent_id</code>, <code>field_weight</code>, and <code>file</code> columns because our postcards are not children of other nodes and don't have their own media. (However, the records for our postcard objects do have a value in <code>field_member_of</code>, which is the node ID of the "Postcards" collection that already/hypothetically exists.) Rows for the postcard front and back image objects have a value in their <code>field_weight</code> field, and they have values in their <code>file</code> column because we are creating objects that contain image media. Importantly, they have no value in their <code>field_member_of</code> field because the node ID of the parent isn't known when you create your CSV; instead, Islandora Workbench assigns each child's <code>field_member_of</code> dynamically, just after its parent node is created.</p>
<p>Some important things to note:</p>
<ul>
<li>Currently, you need to include the option <code>allow_missing_files: true</code> in your configuration file when using this method to create paged/compound content. See <a href="https://github.com/mjordan/islandora_workbench/issues/297">this issue</a> for more information.</li>
<li><code>id</code> can be defined as another field name using the <code>id_field</code> configuration option. If you do define a different ID field using the <code>id_field</code> option, creating the parent/child relationships will still work.</li>
<li>The values of the <code>id</code> and <code>parent_id</code> columns do not have to follow any sequential pattern. Islandora Workbench treats them as simple strings and matches them on that basis, without looking for sequential relationships of any kind between the two fields.</li>
<li>The CSV records for children items don't need to come <em>immediately</em> after the record for their parent, but they do need to come after that record. This is because Workbench creates nodes in the order their records are in the CSV file (top to bottom). As long as the parent node has already been created when a child node is created, the parent/child relationship via the child's <code>field_member_of</code> will be correct.</li>
<li>Currently, you must include values in the children's <code>field_weight</code> column (except when creating a collection and its members at the same time; see below). It may be possible to automatically generate values for this field (see <a href="https://github.com/mjordan/islandora_workbench/issues/84">this issue</a>).</li>
<li>Currently, Islandora model values (e.g. "Paged Content", "Page") are not automatically assigned. You must include the correct "Islandora Models" taxonomy term IDs in your <code>field_model</code> column for all parent and child records, as you would for any other Islandora objects you are creating. Like for <code>field_weight</code>, it may be possible to automatically generate values for this field (see <a href="https://github.com/mjordan/islandora_workbench/issues/85">this issue</a>).</li>
</ul>
<h3 id="using-a-secondary-task">Using a secondary task</h3>
<p>You can configure Islandora Workbench to execute two "create" tasks - a primary and a secondary - that will result in all of the objects described in both CSV files being ingested during the same Workbench job. Parent/child relationships between items are created by referencing the row IDs in the primary task's CSV file from the secondary task's CSV file. The benefit of using this method is that each task has its own configuration file, allowing you to create children that have a different Drupal content type than their parents.</p>
<p>The primary task's CSV describes the parent objects, and the secondary task's CSV describes the children. The two are linked via references from children CSV's <code>parent_id</code> values to their parent's <code>id</code> values, much the same way as in the "With page/child-level metadata" method described above. The difference is that the references span CSV files. The parents and children each have their own CSV input file (and in fact, their own configuration file). Each task is a standard Islandora Workbench "create" task, joined by one setting in the primary's configuration file.</p>
<p>In the following example, the top CSV file (the primary) describes the parents, and the bottom CSV file (the secondary) describes the children:</p>
<p><img alt="Secondary task CSV" src="../images/secondary_tasks.png" /></p>
<p>As you can see, values in the <code>parent_id</code> column in the secondary CSV reference values in the <code>id</code> column in the primary CSV: <code>parent_id</code> 001 in the secondary CSV matches <code>id</code> 001 in the primary, <code>parent_id</code> 003 in the secondary matches <code>id</code> 003 in the primary, and so on.</p>
<p>You configure secondary tasks by adding the <code>secondary_tasks</code> setting to your primary configuration file, like this:</p>
<pre><code class="yaml">task: create
host: &quot;http://localhost:8000&quot;
username: admin
password: islandora
# This is the setting that links the two configuration files together.
secondary_tasks: ['children.yml']
input_csv: parents.csv
nodes_only: true
</code></pre>

<p>In the <code>secondary_tasks</code> setting, you name the configuration file of the secondary task. The secondary task's configuration file (in this example, named "children.yml") contains no indication that it's a secondary task:</p>
<pre><code class="yaml">task: create
host: &quot;http://localhost:8000&quot;
username: admin
password: islandora
input_csv: kids.csv
csv_field_templates:
 - field_model: http://purl.org/coar/resource_type/c_c513
</code></pre>

<p>When you run Workbench, it executes the primary task first, then the secondary task. Workbench keeps track of pairs of <code>id</code> + node IDs created in the primary task, and during the execution of the secondary task, uses these to populate the <code>field_member_of</code> values in the secondary task with the node IDs corresponding to the referenced primary <code>id</code> values.</p>
<p>Some things to note about secondary tasks:</p>
<ul>
<li>Only "create" tasks can be used as the primary and secondary tasks.</li>
<li>When you have a secondary task configured, running <code>--check</code> will validate both tasks' configuration and input data.</li>
<li>The secondary CSV must contain <code>parent_id</code>, <code>field_weight</code>, and <code>field_member_of</code> columns. <code>field_member_of</code> must be empty, since it is auto-populated by Workbench using node IDs from the newly created parent objects.</li>
<li>As already stated, each task has its own configuration file, which means that you can specify a <code>content_type</code> value in your secondary configuration file that differs from the <code>content_type</code> of the primary task.</li>
<li>You can include more than one secondary task in your configuration. For example, <code>secondary_tasks: ['first.yml', 'second.yml']</code> will execute the primary task, then the "first.yml" secondary task, then the "second.yml" secondary task in that order.</li>
<li>The <code>nodes_only</code> setting in the example primary configuration file and the <code>csv_field_templates</code> setting in the secondary configuration file are not relevant to the primary/secondary task functionality; they're included to illustrate that the two configuration files can differ. </li>
</ul>
<h3 id="creating-collections-and-members-together">Creating collections and members together</h3>
<p>Using a variation of the "With page/child-level metadata" approach, you can create a collection node and assign members to it at the same time (i.e., in a single Workbench job). Here is a simple example CSV which shows the references from the members' <code>parent_id</code> field to the collections' <code>id</code> field:</p>
<pre><code class="text">id,parent_id,file,title,field_model,field_member_of,field_weight
1,,,A collection of animal photos,24,,
2,1,cat.jpg,Picture of a cat,25,,
3,1,dog.jpg,Picture of a dog,25,,
3,1,horse.jpg,Picture of a horse,25,,
</code></pre>

<p>The use of the <code>parent_id</code> and <code>field_member_of</code> fields is the same here as when creating paged or compound children. However, unlike with paged or compound objects, in this case we leave the values in <code>field_weight</code> empty, since Islandora collections don't use <code>field_weight</code> to determine order of members. Collection Views are sorted using other fields.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Creating collection nodes and member nodes using this method assumes that collection nodes and member nodes have the same Drupal content type. If your collection objects have a Drupal content type that differs from their members' content type, you need to use the "Using a secondary task" method to ingest collections and members in the same Workbench job.</p>
</div>
<h3 id="summary">Summary</h3>
<p>The following table summarizes the different ways Workbench can be used to create parent/child relationships between nodes:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Relationships created by</th>
<th>field_weight</th>
<th>Advantage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Subdirectories</td>
<td>Directory structure</td>
<td>Do not include column in CSV; autopopulated.</td>
<td>Useful for creating paged content where paged don't have their own metadata.</td>
</tr>
<tr>
<td>Parent/child-level metadata in same CSV</td>
<td>References from child's <code>parent_id</code> to parent's <code>id</code> in same CSV data</td>
<td>Column required; values required in child rows</td>
<td>Allows including parent and child metadata in same CSV.</td>
</tr>
<tr>
<td>Secondary task</td>
<td>References from <code>parent_id</code> in child CSV file to <code>id</code> in parent CSV file</td>
<td>Column and values required in secondary (child) CSV data</td>
<td>Primary and secondary tasks have their own configuration and CSV files, which allows children to have a Drupal content type that differs from their parents' content type. Allows creation of parents and children in same Workbench job.</td>
</tr>
<tr>
<td>Collections and members together</td>
<td>References from child (member) <code>parent_id</code> fields to parent (collection) <code>id</code> fields in same CSV data</td>
<td>Column required in CSV but must be empty (collections do not use weight to determine sort order)</td>
<td>Allows creation of collection and members in same Islandora Workbench job.</td>
</tr>
</tbody>
</table>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../nodes_only/" class="btn btn-neutral float-right" title="Creating nodes without media">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../field_templates/" class="btn btn-neutral" title="CSV field templates"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/mjordan/islandora_workbench_docs/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../field_templates/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../nodes_only/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
